"use strict";(self.webpackChunkmg_documentation=self.webpackChunkmg_documentation||[]).push([[510],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return m}});var i=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=i.createContext({}),p=function(e){var t=i.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(a),m=n,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return a?i.createElement(h,l(l({ref:t},u),{},{components:a})):i.createElement(h,l({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,l=new Array(r);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var p=2;p<r;p++)l[p]=a[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,a)}d.displayName="MDXCreateElement"},3898:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var i=a(7462),n=a(3366),r=(a(7294),a(3905)),l=["components"],o={},s="DEALER IN APP PURCHASE MODULE",p={unversionedId:"Dealer",id:"Dealer",isDocsHomePage:!1,title:"DEALER IN APP PURCHASE MODULE",description:"Introduction",source:"@site/docs/Dealer.md",sourceDirName:".",slug:"/Dealer",permalink:"/documentation/docs/Dealer",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/Dealer.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"DATA USAGE CONSENT",permalink:"/documentation/docs/Data Usage Consent"},next:{title:"LOGGER MODULE",permalink:"/documentation/docs/Logger"}},u=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"How to Use",id:"how-to-use",children:[],level:2},{value:"How does this work?",id:"how-does-this-work",children:[{value:"Product Definition",id:"product-definition",children:[],level:3}],level:2},{value:"API &amp; Details",id:"api--details",children:[],level:2}],c={toc:u};function d(e){var t=e.components,o=(0,n.Z)(e,l);return(0,r.kt)("wrapper",(0,i.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"dealer-in-app-purchase-module"},"DEALER IN APP PURCHASE MODULE"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Dealer module is for managing IAP Products easily. It allows you to create, edit and delete products\nfrom editor GUIs and provides a simple API to initiate purchases, or restore previous purchases."),(0,r.kt)("h2",{id:"how-to-use"},"How to Use"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Import Dealer proxy module from Package Manager UI."),(0,r.kt)("li",{parentName:"ul"},"By default, the proxy module comes bundled with the Unity IAP service as a sample that can be imported from the\nPackage Manager UI.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If you are going to use Unity IAP, you need to first prepare it. Follow Unity's documentation for\nsetting up Unity Purchasing.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"After Unity IAP is set up correctly, import the Unity IAP sample from the Package Manager UI."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"Import sample",src:a(1727).Z})))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Now, open product list from ",(0,r.kt)("inlineCode",{parentName:"p"},"Matchingham > In App Purchases > Config")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"Config",src:a(5561).Z})))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To add a new product, either click ",(0,r.kt)("inlineCode",{parentName:"p"},"Add Product")," in Dealer Iap Config editor, or\nnavigate to ",(0,r.kt)("inlineCode",{parentName:"p"},"Matchingham > In App Purchases > Add Product"),"."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"Config",src:a(1025).Z})))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"From the ",(0,r.kt)("inlineCode",{parentName:"p"},"Add Product")," window, enter product details (id, store specific id for android and ios app stores)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Make sure product ids follow the format: com.","[company]",".","[game]",".","[productid]",".\nFor example: com.somecomp.somegame.subs."),(0,r.kt)("li",{parentName:"ul"},"This is important because analytics integration uses this format to detect which item is purchased."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Hit create to create the product. It will be listed in product list, and an item that will represent the iap\nproduct will automatically be created and added to item database. "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can use this item to check if the user has a certain in-app product purchased."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Make sure to call ",(0,r.kt)("inlineCode",{parentName:"p"},"Dealer.Instance.Initialize()")," at the appropriate place to initialize module.\n"))),(0,r.kt)("h2",{id:"how-does-this-work"},"How does this work?"),(0,r.kt)("p",null,"Dealer is a proxy module. It provides a static API, that will be used for all IAP operations, regardless of\nwhat IAP framework/service is being used. By default, it comes with a Unity Purchasing service integration\nready to import as a sample. It is a sample because Unity Purchasing gerenates some code inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"Assets"),"\nfolder. Because of this, Unity Iap Service needs to be inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"Assets")," folder, otherwise there would be\ncompile errors, as unity first compiles the package assemblies, then the project assembly."),(0,r.kt)("p",null,"You can create custom IAP service implementations by implementing ",(0,r.kt)("inlineCode",{parentName:"p"},"IDealerService")," interface."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c#"},"public interface IDealerService : IAsyncInitialize\n{\n    event BusyStateDelegate BusyStateChanged;\n    event PurchaseSuccessDelegate Purchased;\n    event PurchaseFailDelegate Failed;\n    event Action RestoreSuccess;\n    event Action RestoreFailed;\n    event ProductExpireDelegate Expired;\n    \n    void Initialize();\n    void RequestRestore();\n    void RequestPurchase(string productId, params string[] tags);\n    IEnumerable<IapProduct> GetProducts(Func<IapProduct, bool> filter);\n    IapProduct GetProduct(string productId);\n}\n")),(0,r.kt)("h3",{id:"product-definition"},"Product Definition"),(0,r.kt)("p",null,"An IAP Product needs an in-game product id. Dealer uses this id to initiate purchases, track them and also\nsend analytics data. Store specific ids are provided separately for android and ios. The sample product\ndefinition in the below image is a subscription item."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Subscription type is selected in the ",(0,r.kt)("inlineCode",{parentName:"li"},"Type")," dropdown"),(0,r.kt)("li",{parentName:"ul"},"It has 3 rewards defined:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"200 coins that are rewarded at purchase. These coins are not deduced from the inventory when subscription\nexpires. (",(0,r.kt)("inlineCode",{parentName:"li"},"Give And Forget")," is checked)"),(0,r.kt)("li",{parentName:"ul"},"No Ads item is also rewarded to the player. This item is deduced from player inventory when the subscription\nexpires. (",(0,r.kt)("inlineCode",{parentName:"li"},"Give And Forget")," is NOT checked)"),(0,r.kt)("li",{parentName:"ul"},"Subscription Skin is a cosmetic item that the player is allowed to own as long as they have a subscription.\nSo it is deduced from player inventory when subscription expires. (",(0,r.kt)("inlineCode",{parentName:"li"},"Give And Forget")," is NOT checked)"))),(0,r.kt)("li",{parentName:"ul"},"By default, this product is listed with following metadata. This data is overwritten with metadata from the\nstore:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Title is ",(0,r.kt)("inlineCode",{parentName:"li"},"Subscription"),", and product description is ",(0,r.kt)("inlineCode",{parentName:"li"},"Subscription"),"."),(0,r.kt)("li",{parentName:"ul"},"It is listed with ",(0,r.kt)("inlineCode",{parentName:"li"},"$9.99")," (9.99 USD) price tag."),(0,r.kt)("li",{parentName:"ul"},"For analytics info, price and currency code is also provided separately.")))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Product Create",src:a(4209).Z})),(0,r.kt)("h2",{id:"api--details"},"API & Details"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Initialize()"),": Starts module initialization. You need to call this method at the appropriate place.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"event BusyStateChanged"),": Notifies that Dealer service is busy.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-c#"},"public delegate void BusyStateDelegate(bool isBusy);\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This event can be used to toggle in game indicators like a loading/processing view for the iap operation."),(0,r.kt)("li",{parentName:"ul"},"If the provided parameter is ",(0,r.kt)("inlineCode",{parentName:"li"},"true")," this means that module is busy processing either a\npurchase or a restore. "),(0,r.kt)("li",{parentName:"ul"},"If the provided parameter is ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," this means that module is not busy."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"event Purchased"),": Notifies that a purchase operation was successful. ",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-c#"},"public delegate void PurchaseSuccessDelegate(PurchaseInfo info, bool notifyUser);\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Use this event to display a success feedback to the user.")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"event Failed"),": Notifies that a purchase operation has failed.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-c#"},"public delegate void PurchaseFailDelegate(IapProduct product, PurchaseFailReason failReason, bool notifyUser);\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Use this event to display a failure feedback to the user."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"event RestoreSuccess"),": Notifies that restore request was successful.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can use this event to display a restore successful message.")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"event RestoreFailed"),": Notifies that restore request failed.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can use this event to display a restore failure message.")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"event Expired"),": Notifies that a product has expired.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-c#"},"public delegate void ProductExpireDelegate(IapProduct product);\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If you want to notify a user that their subscription has expired, you can use this event.")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"RequestRestore()"),": Asks the store provider to restore user's previously purchased products.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"RequestPurchase(productId: string, tags: params string[])"),": Asks the store to start purchasing flow\nfor a certain in app product described by the ",(0,r.kt)("inlineCode",{parentName:"li"},"productId"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can provide custom tags using the ",(0,r.kt)("inlineCode",{parentName:"li"},"tags")," parameter to provide purchase metadata for analytics. ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"For example, purchases made from an in game shop interface can provide ",(0,r.kt)("inlineCode",{parentName:"li"},"in-game-shop")," tag while\nan item purchased from an in game campaign banner can provide ",(0,r.kt)("inlineCode",{parentName:"li"},"some-campaign-banner")," tag. This allows\nin depth analysis of in app purchases.")))))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"GetProducts(filter: Func<IapProduct, bool> (null))"),": Returns list of all products.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"You can use the optional filter parameter to filter items returned.")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"GetProduct(productId: string)"),": Try to get a specific product using its id. If no item exists with that id,\nreturns ",(0,r.kt)("inlineCode",{parentName:"li"},"null"),".")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"IsPurchased(IapProduct product)"),": Checks whether the product with given id is purchased\n(currently in player's inventory).")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WhenInitialized(Action)"),": Allows you to register a callback that will be fired only\nafter the module is successfully initialized. Use this to execute logic that requires\nthis module to be initialized first. If the module has already initialized, immediately\ninvokes the callback.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WhenFailedToInitialize(Action)"),": Allows you to register a callback that will be fired only after\nthe module fails to initialize for any reason. Use this to handle what should happen\nin case this module fails to initialize. If the module has already failed to initialize, immediately\ninvokes the callback.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WhenReady(Action)"),": Combined version of ",(0,r.kt)("inlineCode",{parentName:"li"},"WhenInitialized")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"WhenFailedToInitialize"),".\nDelays execution of callback till module is first initialized or failed to initialize, immediately invoke\nthe callback if it is already initialized or failed to initialize.")))}d.isMDXComponent=!0},1025:function(e,t,a){t.Z=a.p+"assets/images/iap-add-product-6eb576c227baca431fd4425c44e338c5.png"},5561:function(e,t,a){t.Z=a.p+"assets/images/iap-config-6a6d891a545ba1804eef6b0c2577bf82.png"},1727:function(e,t,a){t.Z=a.p+"assets/images/iap-import-sample-8af75bb3bd6a0e2b9d0948a921acff2a.png"},4209:function(e,t,a){t.Z=a.p+"assets/images/iap-product-create-4d36678045fac8fd1432829f4da0d3c8.png"}}]);